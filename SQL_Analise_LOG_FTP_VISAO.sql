--CREATE TABLE ANALISE_VISAO (LOG_FTP CLOB);
--CREATE TABLE ARQUIVOS_VISAO (ARQUIVO VARCHAR2(55));


 
SELECT (SUBSTR(LOG_FTP,
                      INSTR(LOG_FTP,'+'||CHR(10),INSTR(LOG_FTP,'PEDZAM_05651966000455_20190724163350_0001145988.txt',1,1)-146,1)+1,
                       INSTR(LOG_FTP,'+'||CHR(10),INSTR(LOG_FTP,'PEDZAM_05651966000455_20190724163350_0001145988.txt',1,1),1)+1 - 
                      INSTR(LOG_FTP,'+'||CHR(10),INSTR(LOG_FTP,'PEDZAM_05651966000455_20190724163350_0001145988.txt',1,1)-146,1)))
--       INSTR(LOG_FTP,'+'||CHR(10),INSTR(LOG_FTP,'PEDZAM_05651966000455_20190702175544_0001142026.txt',1,1)-300,1) POSICAO_INICIAL_BLOCO,
--       INSTR(LOG_FTP,'+'||CHR(10),INSTR(LOG_FTP,'PEDZAM_05651966000455_20190702175544_0001142026.txt',1,1),1)+1 POSICAO_FINAL_BLOCO,
--       INSTR(LOG_FTP,'PEDZAM_05651966000455_20190702175544_0001142026.txt',1,1) PRIMEIRA_OCORRENCIA,
 FROM ANALISE_VISAO ; 
 
SELECT ARQUIVO, 
        
SELECT ARQUIVO,
/*       (SELECT (SUBSTR(LOG_FTP,
                 INSTR(LOG_FTP,'+'||CHR(10),INSTR(LOG_FTP,ARQUIVO,1,1)-146,1)+1,
       	         INSTR(LOG_FTP,'+'||CHR(10),INSTR(LOG_FTP,ARQUIVO,1,1),1)+1 - 
                 INSTR(LOG_FTP,'+'||CHR(10),INSTR(LOG_FTP,ARQUIVO,1,1)-146,1)))
          FROM ANALISE_VISAO) AS LOG_FTP,*/
     (length((SELECT (SUBSTR(LOG_FTP,
                 INSTR(LOG_FTP,'+'||CHR(10),INSTR(LOG_FTP,ARQUIVO,1,1)-146,1)+1,
       	         INSTR(LOG_FTP,'+'||CHR(10),INSTR(LOG_FTP,ARQUIVO,1,1),1)+1 - 
                 INSTR(LOG_FTP,'+'||CHR(10),INSTR(LOG_FTP,ARQUIVO,1,1)-146,1)))
          FROM ANALISE_VISAO)) - length(replace((SELECT (SUBSTR(LOG_FTP,
                 INSTR(LOG_FTP,'+'||CHR(10),INSTR(LOG_FTP,ARQUIVO,1,1)-146,1)+1,
       	         INSTR(LOG_FTP,'+'||CHR(10),INSTR(LOG_FTP,ARQUIVO,1,1),1)+1 - 
                 INSTR(LOG_FTP,'+'||CHR(10),INSTR(LOG_FTP,ARQUIVO,1,1)-146,1)))
          FROM ANALISE_VISAO), 'OK UPLOAD', null)))/9 AS QTDE_UPLOADS_EFETUADOS
 FROM ARQUIVOS_VISAO
 
