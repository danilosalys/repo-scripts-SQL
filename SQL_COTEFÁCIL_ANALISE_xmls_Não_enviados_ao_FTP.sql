CREATE TABLE CLIENTES_ANALISE_XML(XMLCNPJ VARCHAR2(14) PRIMARY KEY, XMLAN8 NUMBER) ;

--Inserir os cnpj e codigo do clients
INSERT INTO CLIENTES_ANALISE_XML 
SELECT TRIM(ABTAX), ABAN8 FROM PRODDTA.F0101
WHERE ABTAX IN ('11445713000185',
'07645910000170',
'21168965000168',
'13587328000106',
'45100138001172',
'08388311000181',
'45100138000281',
'11445713000185',
'08756077000106',
'03257696000205',
'04585233000154',
'07444660000100',
'03257696000124',
'09369805000181',
'44663631000247',
'25891094000248',
'05947352000172',
'86549722000115',
'05947352000253',
'02687852000396',
'50480953000334',
'02588995000189',
'05776520000104',
'07633141000271',
'02108951000295',
'09539393000342',
'66872888000241',
'26898478000174',
'18130757000165',
'02687852000205',
'44515294000160',
'06027782000210',
'05351946000116',
'33438250000167',
'60184751002695',
'02543945000690',
'48721401000400',
'21602556000128',
'10333495000124',
'66916305000318',
'03427005000193',
'02691334000184',
'20732481000137',
'14169897000196',
'14169897000277',
'12270340000111',
'14169897000781',
'14169897000609',
'47423306000203',
'10992762000256',
'52823747000143',
'47423306000114',
'14169897000510',
'10709452000109',
'08042852000153',
'79101192000344',
'08847566000165',
'18754807000185',
'13746302000236',
'07741201000199',
'14169897000439',
'14169897000358',
'10585211000197',
'04187110000165',
'01581028000122',
'65457046000694',
'53933826000170',
'19811370000137',
'48204341000377',
'04766890000106',
'13721510000108',
'61412110052384',
'01455256000156',
'65457046000341',
'08809118000177',
'60184751001109',
'55395404000113',
'57258592000163',
'43892314000159',
'33438250044539',
'59630749000165',
'53164448000107',
'50358415000100',
'09641897000107',
'18606743000175',
'55901839000192',
'03135166000103',
'61412110007320',
'10420458000153',
'60759271000157',
'10639859000107',
'06011149000152',
'01617371000180',
'45163276000129',
'02196623000107',
'17811481000118',
'02196623000298',
'11242675000163',
'14263327000160',
'08354260000177',
'64957160000106',
'15076929000171',
'07680452000100',
'00945605000155',
'10969431000114',
'01970451000114',
'25820960000129',
'02178039000129',
'07514919000142',
'49031370000185',
'00204207000188',
'04196914000120',
'03257696000710',
'16827112000150',
'12065716000156',
'25820960000552',
'25820960000390',
'57503393000173',
'11183782000168',
'11095958000120',
'38534269000201',
'25820960000471',
'06173216000135',
'01996805000108',
'03131954000121',
'07226636000103',
'57907735000110',
'02922932000117',
'08980317000143',
'11576172000124',
'00677228000110',
'16385063000143',
'12295094000152',
'24048431000196',
'65338402000146',
'05582818000183',
'10309726000164',
'60232956000140',
'18165084000189',
'10442116000134',
'09296729000121',
'14150243000110',
'17921115000111',
'03207600000113',
'07283111000100',
'50945484000110',
'04237951000130',
'04232895000140',
'58021841000165',
'13874368000120',
'07682880000172',
'25875857000186',
'10784022000305',
'67112813000144',
'50960574000180',
'21245970000127',
'96645254000136',
'45247202000170',
'54105895000158',
'16973669000108',
'53415907000188',
'07975720000111',
'13881191000190',
'07512573000143',
'01374296000173',
'11629453000106',
'72834815000187',
'09246986000159',
'21617181000170',
'05993248000114',
'65938334000156',
'61208955000123',
'10704665000130',
'12411917000168',
'06112442000106',
'12670355000177',
'14536781000148',
'65762692000231',
'10404496000112',
'08734570000117',
'07859313000149',
'09437731000173',
'07985501000113',
'17091175000154',
'10988627000156',
'10906155000145',
'42953463000118',
'15420138000117',
'15420138000206',
'50048123000170',
'49683246000102',
'18829089000169',
'65988842000149',
'61914750000163',
'10428719000181',
'12516131000105',
'21328620000124',
'01913782000112',
'10374602000162',
'06960729000196',
'05529716000102',
'06011149000314',
'13530387000130',
'24045197000143',
'02731264000140',
'20068292000101',
'18666741000171',
'04537595000170',
'03940489000170',
'10992762000175',
'10992762000337',
'67212308000171',
'67535377000116',
'00228591000159',
'19137034000150',
'05628142000111',
'17685872000133',
'00328940000104',
'21355991000103',
'00154801000101',
'03762734000104',
'66567959000111',
'04982059000183',
'21889258000160',
'57767626000145',
'53603049000103',
'18985806000141',
'67220822000582',
'14708268000197',
'01259941000107',
'67220822000159',
'67220822000230',
'67220822000400',
'60486982000103',
'10775570000107',
'67220822000310',
'21178663000170',
'55364483000103',
'03203383000193',
'13459225000152',
'06074390000120',
'07274591000134',
'41794058000212',
'17526089000127',
'15801326000195',
'03322733000130',
'05848543000187',
'07795097000115',
'05540301000121',
'21705181000121',
'53651253000191',
'02978684000126',
'03344103000167',
'57600140000118',
'49663347000103',
'06120061000179',
'54465992000151',
'57519829000112',
'69135796000196',
'00487239000138',
'02350644000135',
'13686620000178',
'55487201000157',
'55109920000134',
'02837724000110',
'64708787000123',
'12815962000188',
'96452313000150',
'47963806000149',
'44100154000120',
'03446277000130'
);

--PROBLEMAS DE CADASTRO DE ENDEREÇOS ELETRONICOS C/ AS RESPECTIVAS TRATATIVAS
SELECT ABAN8 as CODIGO_CLIENTE, ABAT1, ABTAX CNPJ, ABALPH RAZAO_SOCIAL, ABAC16 ESTADO , TRATATIVA
  FROM PRODDTA.F0101 , 
(
select xmlan8,
       'Não possui cadastro nenhuma na tela de Endereços Eletrônicos: CADASTRAR DIRETORIO' AS "TRATATIVA"
  from CLIENTES_ANALISE_XML
 where xmlan8 not in
       (SELECT distinct eaan8
          FROM PRODDTA.f01151
         WHERE EAAN8 IN (select XMLAN8 from CLIENTES_ANALISE_XML))
UNION
select xmlan8,
       'Não possui o diretório C:\XML\COTEFACIL cadastrado na tela de Endereços Eletrônicos: CADASTRAR DIRETÓRIO ' AS "TRATATIVA"
  from CLIENTES_ANALISE_XML
 where xmlan8 in
       (SELECT distinct eaan8
          FROM PRODDTA.f01151
         WHERE EAAN8 IN (select XMLAN8 from CLIENTES_ANALISE_XML)
           AND eaan8 NOT IN
               (SELECT distinct eaan8
                  FROM PRODDTA.f01151
                 WHERE EAAN8 IN (select XMLAN8 from CLIENTES_ANALISE_XML)
                   AND TRIM(EAETP) = 'D'))
UNION
select xmlan8,
       'Possui diretorio diferente de "c:\xml\cotefacil" na tela de E-Mails: TROCAR DIRETORIO, OU ENVIAR MANUALMENTE OS ARQUIVOS' as "TRATATIVA"
  from CLIENTES_ANALISE_XML
 where xmlan8 in
       (SELECT distinct eaan8
          FROM PRODDTA.f01151
         WHERE EAAN8 IN (select XMLAN8 from CLIENTES_ANALISE_XML)
           AND eaan8 in
               (SELECT distinct eaan8
                  FROM PRODDTA.f01151
                 WHERE EAAN8 IN (select XMLAN8 from CLIENTES_ANALISE_XML)
                   AND TRIM(EAETP) = 'D')
           AND eaan8 NOT IN
               (SELECT distinct eaan8
                  FROM PRODDTA.f01151
                 WHERE EAAN8 IN (select XMLAN8 from CLIENTES_ANALISE_XML)
                   AND TRIM(EAETP) = 'D'
                   AND upper(EAEMAL) LIKE upper('%cot%')))) CLIENTES_PROBLEMA
where aban8 = xmlan8
  --and abat1 = 'C'


--Após analisar, apagar a tabela temporária 
DROP TABLE CLIENTES_ANALISE_XML;



--LEVANTAMENTO  DE NOTAS PARA REENVIO DO XML
SELECT DB_EDIP_PEDMERC    as PEDIDO_MERCANET,
       PEDIDO             AS PEDIDO_COTEFACIL,
       DB_NOTA_DT_EMISSAO AS DATA_EMISSAO,
       DB_NOTA_NRO        AS NUMERO_NOTA,
       DB_NOTA_SERIE      AS SERIE,
       DB_NOTA_OBSERV     AS CHAVE_NF
  FROM DSALES.PEDIDOS_SEM_XML,
       MERCANET_PRD.DB_EDI_PEDIDO,
       MERCANET_PRD.DB_PEDIDO,
       MERCANET_PRD.DB_NOTA_FISCAL
 WHERE DB_EDIP_NRO(+) = PEDIDO
   AND DB_EDIP_PEDMERC = DB_PED_NRO(+)
   AND DB_PED_NRO = DB_NOTA_PED_MERC(+)
ORDER BY DB_EDIP_NRO 











